<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Payoff Plan Generator</title>
  <style>
    :root{--bg:#f5f7fb;--accent:#0b6efd;--muted:#6b7280;}
    body{font-family:Inter, system-ui, -apple-system, Arial; background:var(--bg); margin:0; padding:28px;}
    .wrap{max-width:920px;margin:0 auto}
    .card{background:#fff;padding:22px;border-radius:12px;box-shadow:0 6px 24px rgba(12,15,30,0.06)}
    h1{margin:0 0 8px}
    p.lead{margin:0 0 16px;color:var(--muted)}
    form{display:grid;grid-template-columns:1fr 1fr;gap:12px 18px;align-items:end}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=number]{padding:8px;border-radius:8px;border:1px solid #e6e9ef;width:100%}
    .full{grid-column:1/-1}
    .controls{display:flex;gap:10px}
    button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;background:var(--accent);color:#fff;font-weight:600}
    button.secondary{background:#fff;color:var(--accent);border:1px solid #dbe6ff}
    .results{margin-top:18px;display:flex;gap:16px;flex-wrap:wrap}
    .panel{background:#fafcff;padding:12px;border-radius:10px;min-width:260px;flex:1}
    table{width:100%;border-collapse:collapse;background:#fff;margin-top:12px;border-radius:8px;overflow:hidden}
    th,td{padding:8px 10px;border-bottom:1px solid #eef2f6;text-align:left;font-size:13px}
    th{background:#f6f9ff;font-weight:700}
    footer.small{margin-top:14px;font-size:12px;color:var(--muted)}
    @media(max-width:720px){form{grid-template-columns:1fr}.controls{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-labelledby="title">
      <h1 id="title">Payoff Plan Generator</h1>
      <p class="lead">Estimate months to payoff and total interest. Educational tool — not financial advice.</p>

      <form id="calcForm" onsubmit="return false;">
        <div>
          <label for="balance">Loan balance ($)</label>
          <input id="balance" type="number" min="0" step="0.01" value="12000" inputmode="decimal" />
        </div>

        <div>
          <label for="apr">Annual interest rate (%)</label>
          <input id="apr" type="number" min="0" step="0.01" value="18" inputmode="decimal" />
        </div>

        <div>
          <label for="payment">Monthly payment ($)</label>
          <input id="payment" type="number" min="0" step="0.01" value="260" inputmode="decimal" />
        </div>

        <div>
          <label for="extra">Extra monthly payment ($)</label>
          <input id="extra" type="number" min="0" step="0.01" value="0" inputmode="decimal" />
        </div>

        <div class="full controls">
          <button id="calcBtn" type="button">Calculate</button>
          <button id="downloadCSV" class="secondary" type="button">Download CSV</button>
          <button id="copySummary" class="secondary" type="button">Copy Summary</button>
        </div>
      </form>

      <div class="results" aria-live="polite">
        <div class="panel" id="resultSummary">
          <h3>Summary</h3>
          <div id="summaryText" style="font-family:monospace;white-space:pre-line">Enter numbers and press Calculate.</div>
        </div>

        <div class="panel" id="resultTablePanel">
          <h3>Amortization (first 24 rows)</h3>
          <div id="tableWrap">
            <table aria-describedby="tableDesc" id="amortTable">
              <thead><tr><th>Month</th><th>Start</th><th>Payment</th><th>Interest</th><th>Principal</th><th>End</th></tr></thead>
              <tbody id="amortBody"><tr><td colspan="6" style="color:#6b7280">No results yet</td></tr></tbody>
            </table>
          </div>
        </div>
      </div>

      <footer class="small">Disclaimer: This tool provides estimates only. Do not enter sensitive personal data. No data is sent anywhere in this static version.</footer>
    </div>
  </div>

<script>
  // Calculator logic (safe DOM usage)
  function amortize(balance, annualRate, monthlyPayment){
    const r = annualRate/12/100;
    let month = 0;
    let totalInterest = 0;
    const rows = [];

    if (balance <= 0) return { error: 'Balance must be greater than 0.' };
    if (monthlyPayment <= 0) return { error: 'Monthly payment must be greater than 0.' };

    while (balance > 0.01 && month < 1200){
      month++;
      const interest = balance * r;
      if (monthlyPayment <= interest + 1e-12){
        return { error: 'Payment too small to cover monthly interest. Increase payment.' };
      }
      const payment = Math.min(monthlyPayment, balance + interest);
      const principal = payment - interest;
      const ending = Math.max(0, balance - principal);
      totalInterest += interest;
      rows.push({
        month,
        starting: Number(balance.toFixed(2)),
        payment: Number(payment.toFixed(2)),
        interest: Number(interest.toFixed(2)),
        principal: Number(principal.toFixed(2)),
        ending: Number(ending.toFixed(2))
      });
      balance = ending;
    }

    return { months: month, totalInterest: Number(totalInterest.toFixed(2)), rows };
  }

  const $ = id => document.getElementById(id);
  function renderSummary(res){
    $('summaryText').textContent = `Months to payoff: ${res.months}\nTotal interest: $${res.totalInterest.toFixed(2)}`;
  }
  function renderTable(rows){
    const body = $('amortBody'); body.innerHTML = '';
    const show = rows.slice(0,24);
    for (const r of show){
      const tr = document.createElement('tr');
      [r.month, `$${r.starting.toFixed(2)}`, `$${r.payment.toFixed(2)}`, `$${r.interest.toFixed(2)}`, `$${r.principal.toFixed(2)}`, `$${r.ending.toFixed(2)}`].forEach(val => {
        const td = document.createElement('td'); td.textContent = val; tr.appendChild(td);
      });
      body.appendChild(tr);
    }
    if (show.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td'); td.colSpan = 6; td.textContent = 'No rows to show.'; td.style.color = '#6b7280';
      tr.appendChild(td); body.appendChild(tr);
    }
  }

  function buildCSV(rows){
    const header = ['Month','Start','Payment','Interest','Principal','End'].join(',');
    const lines = rows.map(r => [r.month, r.starting.toFixed(2), r.payment.toFixed(2), r.interest.toFixed(2), r.principal.toFixed(2), r.ending.toFixed(2)].join(','));
    return header + '\n' + lines.join('\n');
  }

  let lastResult = null;

  $('calcBtn').addEventListener('click', () => {
    const bal = parseFloat($('balance').value) || 0;
    const apr = parseFloat($('apr').value) || 0;
    const pay = parseFloat($('payment').value) || 0;
    const extra = parseFloat($('extra').value) || 0;
    const monthly = pay + extra;
    const res = amortize(bal, apr, monthly);
    if (res.error) { $('summaryText').textContent = res.error; $('amortBody').innerHTML = '<tr><td colspan="6" style="color:#6b7280">—</td></tr>'; return; }
    lastResult = res; renderSummary(res); renderTable(res.rows);
  });

  $('downloadCSV').addEventListener('click', () => {
    if (!lastResult) { alert('No results yet. Press Calculate first.'); return; }
    const csv = buildCSV(lastResult.rows);
    const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'amortization.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  $('copySummary').addEventListener('click', async () => {
    if (!lastResult) { alert('No results yet. Press Calculate first.'); return; }
    const text = `Months: ${lastResult.months}\nTotal interest: $${lastResult.totalInterest.toFixed(2)}`;
    try { await navigator.clipboard.writeText(text); alert('Summary copied to clipboard'); } catch(e) { prompt('Copy this summary:', text); }
  });
</script>
</body>
</html>
